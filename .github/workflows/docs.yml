name: Documentation Validation

on:
  push:
    branches: [ main, develop ]
    paths:
      - '**.md'
      - 'docs/**'
      - '.github/workflows/docs.yml'
  pull_request:
    branches: [ main ]
    paths:
      - '**.md'
      - 'docs/**'

jobs:
  markdown-lint:
    name: Markdown Lint
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Lint Markdown files
      uses: actionlint/actionlint@v1
      continue-on-error: true
    
    - name: Check Markdown links
      uses: gaurav-nelson/github-action-markdown-link-check@v1
      with:
        config-file: '.github/markdown-link-check-config.json'
        folder-path: 'docs/'
        file-path: './README.md, ./CONTRIBUTING.md, ./ARCHITECTURE.md'
      continue-on-error: true
  
  validate-examples:
    name: Validate Example Projects
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Check example structure
      run: |
        echo "Validating example projects..."
        
        for dir in examples/*/; do
          example=$(basename "$dir")
          echo "Checking $example..."
          
          # Check README exists
          if [ ! -f "$dir/README.md" ]; then
            echo "❌ Missing README.md in $example"
            exit 1
          fi
          
          # Check manifest file exists
          has_manifest=false
          for file in pom.xml build.gradle package.json requirements.txt Gemfile composer.json Cargo.toml go.mod *.csproj Dockerfile; do
            if [ -f "$dir/$file" ] || [ -f "$dir"*/"$file" ]; then
              has_manifest=true
              break
            fi
          done
          
          if [ "$has_manifest" = false ]; then
            echo "❌ No manifest file found in $example"
            exit 1
          fi
          
          echo "✓ $example is valid"
        done
        
        echo "✅ All examples are valid"
  
  check-documentation:
    name: Check Documentation Completeness
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Check required documentation
      run: |
        REQUIRED_DOCS=(
          "README.md"
          "README.ko.md"
          "CONTRIBUTING.md"
          "ARCHITECTURE.md"
          "PACKAGE_MANAGER_GUIDE.md"
          "TESTING_GUIDE.md"
          "docs/getting-started.md"
          "docs/usage-guide.md"
          "docs/examples-guide.md"
        )
        
        missing=0
        for doc in "${REQUIRED_DOCS[@]}"; do
          if [ ! -f "$doc" ]; then
            echo "❌ Missing: $doc"
            missing=$((missing + 1))
          else
            echo "✓ Found: $doc"
          fi
        done
        
        if [ $missing -gt 0 ]; then
          echo "❌ $missing required documentation files are missing"
          exit 1
        fi
        
        echo "✅ All required documentation files exist"
    
    - name: Check documentation cross-references
      run: |
        echo "Checking documentation links..."
        
        # Check if Architecture is referenced in README
        if ! grep -q "ARCHITECTURE.md" README.md; then
          echo "⚠️  ARCHITECTURE.md not referenced in README.md"
        fi
        
        # Check if examples-guide is referenced
        if ! grep -q "examples-guide" README.md; then
          echo "⚠️  examples-guide not referenced in README.md"
        fi
        
        echo "✅ Documentation cross-reference check complete"
